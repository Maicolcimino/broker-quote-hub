<!doctype html><html><head>
<meta charset="utf-8"><title>Richiesta #{{item.id}}</title>
<style>body{font-family:system-ui;margin:24px} .row{display:flex;gap:24px} .col{flex:1} .box{border:1px solid #ddd;border-radius:8px;padding:12px;margin-bottom:16px} #chat{height:220px;overflow:auto;background:#fafafa;padding:8px;white-space:pre-wrap}</style>
<script>
function startSSE(rid){
  const es=new EventSource(`/r/${rid}/stream`);
  const chat=document.getElementById('chat');
  es.onmessage=(e)=>{ chat.textContent += e.data + "\\n"; chat.scrollTop=chat.scrollHeight; }
}
</script>
</head><body onload="startSSE({{item.id}})">
<a href="/">← Torna alla lista</a>
<h1>Richiesta #{{item.id}}</h1>
<p><b>{{item.customer_name}}</b> — {{item.lob}} — CF/P.IVA: {{item.customer_tax_id}}</p>

<div class="row">
  <div class="col">
    <div class="box">
      <h3>Carica documento</h3>
      <form method="post" action="/r/{{item.id}}/upload" enctype="multipart/form-data">
        <input type="file" name="file" required>
        <button type="submit">Carica</button>
      </form>
    </div>
    <div class="box">
      <h3>Chat</h3>
      <div id="chat"></div>
      <form method="post" action="/r/{{item.id}}/msg" style="margin-top:8px">
        <input name="text" placeholder="Scrivi un messaggio…" required>
        <button type="submit">Invia</button>
      </form>
    </div>
  </div>
</div>
</body></html>
